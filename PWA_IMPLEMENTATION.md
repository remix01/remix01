# PWA Implementation for LiftGO

## Overview
Successfully implemented Progressive Web App (PWA) support for LiftGO with mobile-optimized experience enhancements. The implementation builds on the existing PWA metadata foundation already present in the application.

## Files Added/Modified

### 1. **next.config.ts** (Modified)
- Added `next-pwa` integration with `withPWA()` wrapper
- Configured runtime caching strategies:
  - **NetworkFirst** for API calls (`/api/*`) - prioritizes fresh data
  - **CacheFirst** for images - loads from cache, updates in background
- Configured to disable PWA in development mode (`NODE_ENV === 'development'`)
- Public folder: `public` → Service worker auto-generated to `/public/sw.js`

### 2. **public/manifest.json** (New)
Complete Web App Manifest with:
- Basic metadata (name, short_name, description, lang="sl")
- Display mode: `standalone` (hides browser chrome)
- Theme colors: light/dark aware
- Icons (96x96, 192x192, 512x512, maskable)
- Shortcuts for quick actions:
  - "Oddajte povpraševanje" → `/oddaj-povprasevanje`
  - "Moj profil" → `/dashboard`
- Screenshots for app store listing
- Categories: business, utilities

### 3. **components/pwa/InstallPrompt.tsx** (New)
Mobile install prompt component:
- Appears as bottom sheet 30 seconds after first visit
- Mobile-only detection (checks `navigator.userAgent`)
- Uses `beforeinstallprompt` browser event
- Session-based dismissal (doesn't repeat same session)
- Shows: "Dodajte LiftGO na začetni zaslon" + Namesti/Ne zdaj buttons
- Uses `sessionStorage` for dismissal state (no localStorage)

### 4. **app/layout.tsx** (Modified)
- Added `import { InstallPrompt } from '@/components/pwa/InstallPrompt'`
- Inserted `<InstallPrompt />` before `</body>` tag
- Positioned after ServiceWorkerRegistration, before AgentChatButton

## Features

✅ **Offline Support**: API responses cached with NetworkFirst strategy
✅ **App Installation**: "Add to Home Screen" prompt on mobile
✅ **Standalone Display**: Hides browser UI when launched from home screen
✅ **App Shortcuts**: Quick access to key features from app switcher
✅ **Performance**: Service worker preloads PWA assets
✅ **Smart Caching**: Images cached for 7 days, API responses 60 seconds
✅ **Mobile Detection**: Install prompt only shows on mobile devices
✅ **Session Management**: Dismissal doesn't persist across sessions
✅ **Slovenian Localization**: All UI text in Slovenian

## Technical Details

### Caching Strategy
```typescript
// NetworkFirst: API calls
GET /api/* → Try network first, fallback to cache
Cache: 50 entries, 60-second max age

// CacheFirst: Images
GET images.unsplash.com/* → Serve from cache, update background
Cache: 30 entries, 7-day max age
```

### Install Prompt Flow
1. Page load → check if mobile device
2. Wait 30 seconds
3. Browser fires `beforeinstallprompt` event
4. Show prompt as bottom sheet
5. User can "Namesti" (install) or dismiss
6. Dismissal stored in sessionStorage
7. No repeat prompts during session

### Service Worker
- Auto-generated by `next-pwa` at build time
- Registered in `ServiceWorkerRegistration` component
- Handles requests according to runtime caching strategies
- Skips waiting enabled (`skipWaiting: true`) for instant updates

## Browser Support

✅ Chrome/Chromium (Android, Desktop, Edge)
✅ Firefox (Android support limited)
✅ Safari (iOS 16.4+ with limited PWA features)
✅ Samsung Internet (Android)

## Usage After Deployment

### For Users
1. Open LiftGO on mobile browser
2. Wait 30 seconds → install prompt appears
3. Tap "Namesti" → app installs on home screen
4. Tap LiftGO icon to launch as standalone app
5. Works offline for cached content

### For Developers
- Service worker available at `/public/sw.js`
- PWA assets in `/public/icons/` and `/public/splash/`
- Cache configuration in `next.config.ts`
- Install prompt UX can be customized in `components/pwa/InstallPrompt.tsx`

## Testing

### Desktop (Chrome DevTools)
1. F12 → Application tab
2. Check "Manifest" section
3. Click "Add to Home Screen" to simulate
4. Check "Cache Storage" for cached assets

### Mobile (Real Device)
1. Open LiftGO in Chrome/Edge
2. Wait 30+ seconds
3. Bottom sheet install prompt appears
4. Tap "Namesti"
5. App installs to home screen

### Offline Testing
1. DevTools → Application → Service Workers
2. Check "Offline"
3. Navigate app → should still work for cached routes

## Notes

- Zero breaking changes to existing routes/components
- Existing metadata + PWA features complementary
- Development mode disables PWA (no service worker)
- Production deployment enables full PWA capabilities
- `next-pwa` requires Node.js 16+ for build

## Future Enhancements

- Generate iOS splash screens with `pwa-asset-generator`
- Add background sync for offline form submissions
- Implement periodic background updates for offers
- Add push notifications for new messages
- Create in-app update notifications
